<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="assets/css/style.css">
        <link rel="stylesheet" href="assets/fontawesome-pro-5.15.4/css/all.css">
        <link rel="stylesheet" href="node_modules/bootstrap/dist/css/bootstrap.css">
    </head>
    <style>
        .password-container {
            position: relative; /* Needed for positioning the eye icon */
            width: 300px; /* Adjust as needed */
            margin: 0 auto; /* Center the container */
        }

        .password-field {
            width: 100%; /* Full width of the container */
            padding: 10px;
            padding-right: 40px; /* Make room for the icon */
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 16px; /* Adjust as needed */
        }

        .fal.fa-eye, .fal.fa-eye-slash {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer; /* Change cursor to pointer to indicate it's clickable */
            font-size: 20px; /* Adjust icon size as needed */
            color: #777; /* Icon color */
        }

        /* Optional: Style for hover and focus states */
        .password-field:hover, .password-field:focus {
            border-color: #888;
        }

        .fal.fa-eye:hover, .fal.fa-eye-slash:hover {
            color: #333;
        }
        body {
            position: relative;
            background: url('assets/images/RegistrationBG_Blue.png') no-repeat fixed;
            background-size: cover;
            display: grid;
            height: 100vh;
            margin: 0;
        }

    </style>
    <body>
        <div id="registration" class=" d-flex justify-content-center align-items-center" style="display: none;">
            
            <div class="row">
                <div class="col-md-12 mt-3">
                    <di class="card mb-3" style="width: 40rem;">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-12">
                                    <h1 class="text-center">Guardian Registration</h1>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <p class="text-center">Please fill out the form below to create an account.</p>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-sm-12">
                                    <form id="signupForm">
                                        <div class="row">
                                            <div class="col">
                                                <label for="first_Name" class="h6">*First Name:</label>
                                                <input type="text" class="form-control" id="first_Name" name="firstName" required />
                                            </div>
                                            <!-- <div class="col">
                                                <label for="middle_Name" class="h6">Middle Name:</label>
                                                <input type="text" class="form-control" id="middle_Name" name="middleName" />
                                            </div> -->
                                            <div class="col">
                                                <label for="last_Name" class="h6">*Last Name:</label>
                                                <input type="text" class="form-control" id="last_Name" name="lastName" required />
                                            </div>
                                        </div>
                                        <label for="email" class="h6 mt-2">*Email:</label>
                                        <input type="email" class="form-control" id="email" name="email">
                                        <div class="alert alert-danger mt-2" style="display:none"><i class="far fa-exclamation-triangle"></i> <span id="emailAlert"></span></div>
                                    </form>
                                </div>
                            </di>
                            <div class="row mt-5">
                                <div class="col-sm-6">
                                    <label for="password" class="h6">Create Password:</label>
                                    <div class="password-container">
                                        <input type="password" class="form-control password-field" id="password" name="password">
                                        <i class="fal fa-eye toggle-password"></i>
                                    </div>

                                    <label for="password" class="h6 mt-2">Verify Password:</label>
                                    <div class="password-container ">
                                        <input type="password" class="form-control password-field" id="pwVerify" />
                                        <i class="fal fa-eye toggle-password"></i>
                                    </div>
                                    <a href="https://pages.nist.gov/800-63-3/sp800-63b.html" class="text-uppcercase" style="font-size: 10px; text-decoration: none;">NIST password guidelines</a>
                                    
                                    <input class=" btn btn-primary form-control mt-5 signmeup" type="submit" value="Sign Up" disabled>
                                </div>
                                <div class="col-sm-6">
                                    <h6>Password Requirements</h6>
                                    <ul class="list-group" style="font-size:12px">
                                        <li class="list-group-item" id="length">Contains 12 Characters <span class="checkmark float-start mx-1"></span> </li>
                                        <li class="list-group-item" id="number">Contains Number <span class="checkmark float-start mx-1"></span></li>
                                        <li class="list-group-item" id="lowercase">Contains Lowercase <span class="checkmark float-start mx-1"></span></li>
                                        <li class="list-group-item" id="uppercase">Contains Uppercase <span class="checkmark float-start mx-1"></span></li>
                                        <li class="list-group-item" id="special">Contains Special Character <span class="checkmark float-start mx-1"></span></li>
                                        <li class="list-group-item" id="match">Passwords Verified Match <span class="checkmark float-start mx-1"></span></li>
                                    </ul>
                                </div>
                            </div>

                        </div>
                    </div>
                    
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-12 text-center">
              <span class="text-white">Powered by</span><br>
                <img src="assets/images/landingPage/ShieldLyticsLogoOrbitronHorzWt.svg" height="40" alt="">
            </div>
        </div>
      
        

            

       
       
        
        
        <script src="node_modules/jquery/dist/jquery.js"></script>
        <script src="node_modules/bootstrap/dist/js/bootstrap.bundle.js"></script>
        <script src="node_modules/aos/dist/aos.js"></script>
    </body>
</html>
<script>
$(document).ready(function() {
    //$("#registration").slideDown(500);

    var checkMark = '<i class="fal fa-check"></i>';
    $('.toggle-password').on('click', function() {
        $(this).toggleClass('fa-eye fa-eye-slash');
        var input = $($(this).prev());
        if (input.attr('type') === 'password') {
            input.attr('type', 'text');
        } else {
            input.attr('type', 'password');
        }
    }); 

    function checkPasswordCriteria() {
        var passwordValue = $('#password').val();
        toggleCheckMark('#length', passwordValue.length >= 12);
        toggleCheckMark('#number', /\d/.test(passwordValue));
        toggleCheckMark('#lowercase', /[a-z]/.test(passwordValue));
        toggleCheckMark('#uppercase', /[A-Z]/.test(passwordValue));
        toggleCheckMark('#special', /[!@#$%^&*(),.?":{}|<>]/.test(passwordValue));
    }

    function checkPasswordMatch() {
        var passwordValue = $('#password').val();
        var verifyValue = $('#pwVerify').val();

        toggleCheckMark('#match', passwordValue === verifyValue && passwordValue.length > 0);
    }
    $('#phone').on('keyup', function() {
        var phone = $(this).val().replace(/\D/g, '');
        var match = phone.match(/^(\d{3})(\d{3})(\d{4})$/);
        if (match) {
            $(this).val('(' + match[1] + ') ' + match[2] + '-' + match[3]);
        }
    });

    $('#email').on('input', function() {
        emailVerification();
    });
    
    function toggleCheckMark(id, condition) {
        if (condition) {
            $(id).addClass('text-success').find('.checkmark').html(checkMark);
        } else {
            $(id).removeClass('text-success').find('.checkmark').empty();
        }
    }

    $('#password, #pwVerify').on('input', function() {
        checkPasswordCriteria();
        checkPasswordMatch();
        //remove disabled attribute from submit button
        //if all inputs are empty do not verify passwords until all inputs are filled


        if (verifyInputs()) {
            $('.signmeup').removeAttr('disabled');
        } else {
            $('.signmeup').attr('disabled', 'disabled');
        }
    });

// check password criteria on submit
    $('.signmeup').on('click', function(e) {
        e.preventDefault();
        // Call the function to activate the verification
        
        checkPasswordCriteria();
        checkPasswordMatch();
        emailVerification();
        verifyInputs();
        if (verifyInputs()) {
            registerUser();
        }
    });
    $('#address_line_1, #city, #state, #postal_code, #country').on('keyup', function() {
        // search google for address and populate inputs city, state, postal code, country
        
        searchGoogleForAddress();


    });



});
function searchGoogleForAddress() {
    var address = $('#address_line_1').val() + ' ' + $('#city').val() + ' ' + $('#state').val() + ' ' + $('#postal_code').val() + ' ' + $('#country').val();
    var url = 'https://www.google.com/maps/search/?api=1&query=' + address;
    // search google for address and populate inputs city, state, postal code, country




    
}
function verifyInputs() {

    var isValid = true;
    // List of required field IDs
    var requiredFields = ['first_Name', 'last_Name', 'email', 'phone', 'address_line_1', 'city', 'state', 'postal_code', 'country', 'password', 'pwVerify'];
    // Loop through each required field
    requiredFields.forEach(function(field) {
        // If the field is empty
        if ($('#' + field).val() === '') {
            // Add the error class to the field
            $('#' + field).addClass('is-invalid');
            // Set isValid to false
            isValid = false;
        } else {
            // Remove the error class from the field
            $('#' + field).removeClass('is-invalid');
        }
    });

    return isValid;

}
function registerUser(){
    var data = {
        method: 'registerUser',
        registerNewUser: true,
        firstName: $('#first_Name').val(),
        lastName: $('#last_Name').val(),
        email: $('#email').val(),
        password: $('#password').val()
    }

    $.ajax({
        url: 'assets/PHP/registration.php',
        method: 'POST',
        dataType: 'json',
        data: data,
        success: function(response) {
            console.log(response);
            var message = response.message;
            var status = response.status;
            if (status === 'success') {
                //redirect to login page
                window.location.href = 'login.html';
            } else {
                //display error message
                alert(message);
            }
        },error: function(response) {
            console.log(response);
        }
    });

}
function emailVerification() {
        var email = $('#email').val();
        var valid = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/.test(email);

        if (valid) {
            // Extract the domain from the email
            var domain = email.split('@')[1];

            // Define the allowed domains
            var allowedDomains = {
                "free": [
                    "gmail.com",
                    "yahoo.com",
                    "outlook.com",
                    "aol.com",
                    "zoho.com",
                    "mail.com",
                    "protonmail.com",
                    "gmx.com",
                    "icloud.com",
                    "tutanota.com",
                    "me.com",
                    "hotmail.com"
                ],
                "paid": [
                    "fastmail.com",
                    "hushmail.com",
                    "pobox.com",
                    "protonmail.com",
                    "runbox.com",
                    "mailbox.org",
                    "posteo.de",
                    "hey.com",
                    "zoho.com"
                ]
            };

            // Check if the domain is allowed
            var isAllowedDomain = allowedDomains.free.includes(domain) || allowedDomains.paid.includes(domain);

            if (isAllowedDomain) {
                $(this).removeClass('is-invalid');
                $('#emailAlert').parent().slideDown(300)
            } else {
                // The domain is not allowed
                $(this).addClass('is-invalid');
                //alert('The email provider is not allowed.');
                $('#emailAlert').html('The email provider is not allowed.').parent().slideUp(300);
            }
        } else {
            $(this).addClass('is-invalid');
        }
}



</script>